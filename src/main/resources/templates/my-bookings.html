<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Bookings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-100">
    <div th:replace="~{header :: navbar}"></div>

    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">My Bookings</h1>

        <div th:if="${successMessage}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline" th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline" th:text="${errorMessage}"></span>
        </div>

        <div th:if="${bookings.isEmpty()}" class="text-center py-10 bg-white rounded-lg shadow-md">
            <p class="text-xl text-gray-600">You haven't booked any flights yet.</p>
            <a th:href="@{/}" class="mt-4 inline-block bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700">Search Flights Now</a>
        </div>

        <div th:if="${!bookings.isEmpty()}" class="space-y-6">
            <!-- Iterate over BookingSummaryDTO objects -->
            <div th:each="booking : ${bookings}" class="bg-white p-6 rounded-lg shadow-md flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="flex-grow mb-4 md:mb-0 md:mr-6">
                    <div class="flex items-center mb-2">
                        <span class="font-bold text-lg text-indigo-700 mr-3" th:text="${booking.airlineName}">Airline</span> <!-- Updated -->
                        <span class="text-gray-600 font-mono text-sm" th:text="'PNR: ' + ${booking.pnr}">PNR: EKXYZ123</span>
                    </div>
                    <p class="text-xl font-semibold text-gray-800 mb-1">
                        <span th:text="${booking.source}">Source</span> &rarr; <span th:text="${booking.destination}">Destination</span>
                    </p>
                    <p class="text-gray-600 text-sm" th:text="'Departs: ' + ${#temporals.format(booking.departure, 'dd MMM yyyy, HH:mm')}">Departs: 16 Oct 2025, 10:00</p>
                    <p class="text-gray-800 font-medium mt-1">
                        Seat: <span th:text="${booking.seatNo}">14A</span>
                        (<span th:text="${booking.seatTypeName}">Economy</span>) <!-- Added -->
                    </p>
                     <p class="text-gray-800 font-medium text-sm mt-1" th:text="'Price Paid: ' + ${booking.formattedCalculatedPrice}">Price Paid: $650.00</p> <!-- Added -->
                </div>
                <div class="flex-shrink-0 flex flex-col items-end space-y-2">
                     <span class="px-3 py-1 rounded-full text-xs font-semibold"
                           th:text="${booking.status}"
                           th:classappend="${booking.status == 'CONFIRMED' ? 'bg-green-100 text-green-800' : (booking.status == 'CANCELLED' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800')}">
                           CONFIRMED
                     </span>
                     <form th:if="${booking.isCancellable()}" th:action="@{/bookings/{id}/cancel(id=${booking.bookingId})}" method="post" onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                         <button type="submit" class="text-sm text-red-600 hover:text-red-800 font-medium">Cancel Booking</button>
                     </form>
                </div>
            </div>
        </div>
    </main>
</body>
</html>

